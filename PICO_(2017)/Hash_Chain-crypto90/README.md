## Hash_Chain [CRYPTO 90]

>We found a service hiding a flag! It seems to be using some kind of MD5 Hash Chain authentication to identify who is allowed to see the flag. Maybe there is a flaw you can exploit? hcexample.py has some example code on how to calculate iterations of the MD5 hash chain. Connect to it at shell2017.picoctf.com:47404!
>
>HINTS
>
>Connect from the shell with nc. Read up on how Hash Chains work and try to identify what could make this cryptosystem weak.

* [hcexample.py](hcexample.py)

### EN / [PL](#rozwiązanie)

### Solution:

Once connected, we get a menu with registration and flag options.

```
$ nc shell2017.picoctf.com 47404

*******************************************
***            FlagKeeper 1.1           ***
*  now with HASHCHAIN AUTHENTICATION! XD  *
*******************************************

Would you like to register(r) or get flag(f)?

r/f?

f
This flag only for user 92
Please authenticate as user 92
c08e2ad3be8f3e1315022a957e66bb96
Next token?
```

To get a flag, you have to provide some token. Hmm, maybe it's better to start with the registration ...

```
$ nc shell2017.picoctf.com 47404

*******************************************
***            FlagKeeper 1.1           ***
*  now with HASHCHAIN AUTHENTICATION! XD  *
*******************************************

Would you like to register(r) or get flag(f)?

r/f?

r
Hello new user! Your ID is now 9876 and your assigned hashchain seed is 912e79cd13c64069d91da65d62fbb78c
Please validate your new ID by sending the hash before this one in your hashchain (it will hash to the one I give you):
5d470fa2a1d9e98e5a3e58e5b98fbd6b
```

In `hcexample.py` you can see that the hashchain is being created in a loop where another hash is generated by the previous hash.

But where did you get your first hash? It just hash `ID`.

```
>>> import md5
>>> md5.md5('9876').hexdigest()
'912e79cd13c64069d91da65d62fbb78c'
```

Script:

```python
import md5

seed = '9876'
search = '5d470fa2a1d9e98e5a3e58e5b98fbd6b'

hashc = seed

while True:
    print hashc
    hashc = md5.new(hashc).hexdigest()
    
    if hashc == search:
        break
```

And I get a hashchain.

```
$ python hashchain.py
9876
912e79cd13c64069d91da65d62fbb78c
6429e70accaa59f8ffa32bf7630745a6
2c46161e8d1c9344d91d38a305744d1d
892bdbef59fd83a6f8c2f1c98e92d894
3d7d21af6e5056fa1a7bb3c7fdb52dae
...
94af60aa44eb7499383c9299ed98a48f
e73474216f863de7218d79b3a19a2a39
3fe3f21d365db53803b9a051587b037b
c123c89c60197f95c72e1a31b4a06d5c
c8990d682c07e57676bfd3094b116196
```

At the end there is a hash that you have to provide at registration.

```
$ nc shell2017.picoctf.com 47404

*******************************************
***            FlagKeeper 1.1           ***
*  now with HASHCHAIN AUTHENTICATION! XD  *
*******************************************

Would you like to register(r) or get flag(f)?

r/f?

r
Hello new user! Your ID is now 2773 and your assigned hashchain seed is f565bb9efccaf6986443db0bf01018bc
Please validate your new ID by sending the hash before this one in your hashchain (it will hash to the one I give you):
0e73352d9229ca9491eba1f9695c185e
0d9a1bf12fe49a25c93673d42a3f913c
Yep! That's it! You're validated
```

Ok, now the flag :-)

```
$ nc shell2017.picoctf.com 47404

*******************************************
***            FlagKeeper 1.1           ***
*  now with HASHCHAIN AUTHENTICATION! XD  *
*******************************************

Would you like to register(r) or get flag(f)?

r/f?

f
This flag only for user 4619
Please authenticate as user 4619
68477bed17817fc44990d80ca7c3c97f
Next token?
6cdeebeb8d3da82a55e6c5b69a186f17
Hello user 4619! Here's the flag: 987cd68afbdf22d946461f244bc14391
```

### [EN](#solution) / PL

### Rozwiązanie:

Po połączeniu dostajemy menu z opcjami rejestracji i otrzymania flagi.

```
$ nc shell2017.picoctf.com 47404

*******************************************
***            FlagKeeper 1.1           ***
*  now with HASHCHAIN AUTHENTICATION! XD  *
*******************************************

Would you like to register(r) or get flag(f)?

r/f?

f
This flag only for user 92
Please authenticate as user 92
c08e2ad3be8f3e1315022a957e66bb96
Next token?
```

Żeby dostać flagę, trzeba podać jakiś token. Hmm, może jednak lepiej zacząć od rejestracji...

```
$ nc shell2017.picoctf.com 47404

*******************************************
***            FlagKeeper 1.1           ***
*  now with HASHCHAIN AUTHENTICATION! XD  *
*******************************************

Would you like to register(r) or get flag(f)?

r/f?

r
Hello new user! Your ID is now 9876 and your assigned hashchain seed is 912e79cd13c64069d91da65d62fbb78c
Please validate your new ID by sending the hash before this one in your hashchain (it will hash to the one I give you):
5d470fa2a1d9e98e5a3e58e5b98fbd6b
```

W `hcexample.py` widać, że hashchain tworzony jest w pętli, gdzie kolejny hash powstaje przez hash poprzedniego.

Ale skąd wziąć pierwszy hash? To po prostu hash `ID`.

```
>>> import md5
>>> md5.md5('9876').hexdigest()
'912e79cd13c64069d91da65d62fbb78c'
```

Skrypt:

```python
import md5

seed = '9876'
search = '5d470fa2a1d9e98e5a3e58e5b98fbd6b'

hashc = seed

while True:
    print hashc
    hashc = md5.new(hashc).hexdigest()
    
    if hashc == search:
        break
```

I dostaję hashchain.

```
$ python hashchain.py
9876
912e79cd13c64069d91da65d62fbb78c
6429e70accaa59f8ffa32bf7630745a6
2c46161e8d1c9344d91d38a305744d1d
892bdbef59fd83a6f8c2f1c98e92d894
3d7d21af6e5056fa1a7bb3c7fdb52dae
...
94af60aa44eb7499383c9299ed98a48f
e73474216f863de7218d79b3a19a2a39
3fe3f21d365db53803b9a051587b037b
c123c89c60197f95c72e1a31b4a06d5c
c8990d682c07e57676bfd3094b116196
```

Na końcu jest hash, który trzeba podać przy rejestracji.

```
$ nc shell2017.picoctf.com 47404

*******************************************
***            FlagKeeper 1.1           ***
*  now with HASHCHAIN AUTHENTICATION! XD  *
*******************************************

Would you like to register(r) or get flag(f)?

r/f?

r
Hello new user! Your ID is now 2773 and your assigned hashchain seed is f565bb9efccaf6986443db0bf01018bc
Please validate your new ID by sending the hash before this one in your hashchain (it will hash to the one I give you):
0e73352d9229ca9491eba1f9695c185e
0d9a1bf12fe49a25c93673d42a3f913c
Yep! That's it! You're validated
```

Ok, teraz flaga :-)

```
$ nc shell2017.picoctf.com 47404

*******************************************
***            FlagKeeper 1.1           ***
*  now with HASHCHAIN AUTHENTICATION! XD  *
*******************************************

Would you like to register(r) or get flag(f)?

r/f?

f
This flag only for user 4619
Please authenticate as user 4619
68477bed17817fc44990d80ca7c3c97f
Next token?
6cdeebeb8d3da82a55e6c5b69a186f17
Hello user 4619! Here's the flag: 987cd68afbdf22d946461f244bc14391
```
